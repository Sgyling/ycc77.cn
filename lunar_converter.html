<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>农历日期转换工具</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .result {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }
        .item {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>农历日期转换工具</h1>
        <div class="result" id="result"></div>
    </div>

    <script>
        // 农历数据（简化版）
        const lunarData = [
            0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2,
            0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977,
            0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970,
            0x06566, 0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950,
            0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0, 0x092d0, 0x0d2b2, 0x0a950, 0x0b557,
            0x06ca0, 0x0b550, 0x15355, 0x04da0, 0x0a5d0, 0x14573, 0x052d0, 0x0a9a8, 0x0e950, 0x06aa0,
            0x0aea6, 0x0ab50, 0x04b60, 0x0aae4, 0x0a570, 0x05260, 0x0f263, 0x0d950, 0x05b57, 0x056a0,
            0x096d0, 0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250, 0x0d558, 0x0b540, 0x0b6a0, 0x195a6,
            0x095b0, 0x049b0, 0x0a974, 0x0a4b0, 0x0b27a, 0x06a50, 0x06d40, 0x0af46, 0x0ab60, 0x09570,
            0x04af5, 0x04970, 0x064b0, 0x074a3, 0x0ea50, 0x06b58, 0x055c0, 0x0ab60, 0x096d5, 0x092e0,
            0x0c960, 0x0d954, 0x0d4a0, 0x0da50, 0x07552, 0x056a0, 0x0abb7, 0x025d0, 0x092d0, 0x0cab5,
            0x0a950, 0x0b4a0, 0x0baa4, 0x0ad50, 0x055d9, 0x04ba0, 0x0a5b0, 0x15176, 0x052b0, 0x0a930,
            0x07954, 0x06aa0, 0x0ad50, 0x05b52, 0x04b60, 0x0a6e6, 0x0a4e0, 0x0d260, 0x0ea65, 0x0d530,
            0x05aa0, 0x076a3, 0x096d0, 0x04afb, 0x04ad0, 0x0a4d0, 0x1d0b6, 0x0d250, 0x0d520, 0x0dd45,
            0x0b5a0, 0x056d0, 0x055b2, 0x049b0, 0x0a577, 0x0a4b0, 0x0aa50, 0x1b255, 0x06d20, 0x0ada0
        ];

        const solarTermInfo = [
            0, 21208, 42467, 63836, 85337, 107014, 128867, 150921, 173149, 195551, 218072, 240693,
            263343, 285989, 308563, 331033, 353350, 375494, 397447, 419210, 440795, 462224, 483532, 504758
        ];

        const solarTermNames = [
            '小寒', '大寒', '立春', '雨水', '惊蛰', '春分', '清明', '谷雨',
            '立夏', '小满', '芒种', '夏至', '小暑', '大暑', '立秋', '处暑',
            '白露', '秋分', '寒露', '霜降', '立冬', '小雪', '大雪', '冬至'
        ];

        const gan = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
        const zhi = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
        const animals = ['鼠', '牛', '虎', '兔', '龙', '蛇', '马', '羊', '猴', '鸡', '狗', '猪'];
        const lunarMonthNames = ['正', '二', '三', '四', '五', '六', '七', '八', '九', '十', '冬', '腊'];
        const lunarDayNames = ['初', '十', '廿', '卅'];
        const dayNames = ['一', '二', '三', '四', '五', '六', '七', '八', '九'];

        // 获取当前日期
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth() + 1;
        const day = now.getDate();
        const hour = now.getHours();
        const minute = now.getMinutes();

        // 获取农历日期
        function getLunarDate(solarDate) {
            const y = solarDate.getFullYear();
            const offset = (solarDate - new Date(y, 0, 1)) / 86400000;
            let temp = 0;
            let i = 0;
            
            // 计算从 1900 年到目标年份的总天数偏移量
            for (i = 1900; i < y; i++) {
                temp += getDaysInYear(i);
            }
            let dayOffset = offset + temp;
            
            // 查找对应的农历年份
            i = 1900;
            while (dayOffset >= getDaysInYear(i)) {
                dayOffset -= getDaysInYear(i);
                i++;
            }
            const lunarYear = i;
            let leap = getLeapMonth(lunarYear);
            let isLeap = false;
            
            // 查找对应的农历月份和日期
            i = 1;
            while (i <= 12) {
                if (isLeap) {
                    temp = getLeapDays(lunarYear);
                } else {
                    temp = getMonthDays(lunarYear, i);
                }
                
                if (dayOffset < temp) break;
                dayOffset -= temp;
                
                if (leap === i && !isLeap) {
                    isLeap = true;
                    continue;
                }
                if (isLeap) {
                    isLeap = false;
                }
                i++;
            }
            
            const lunarMonth = i;
            const lunarDay = dayOffset + 1;
            
            return {
                year: lunarYear,
                month: lunarMonth,
                day: lunarDay,
                isLeap: leap > 0 && lunarMonth === leap && isLeap
            };
        }

        // 获取某年的总天数
        function getDaysInYear(y) {
            let sum = 348;
            for (let i = 0x8000; i > 0x8; i >>= 1) {
                sum += (lunarData[y - 1900] & i) ? 1 : 0;
            }
            return sum + getLeapDays(y);
        }

        // 获取某年闰月的天数
        function getLeapDays(y) {
            if (getLeapMonth(y)) {
                return ((lunarData[y - 1900] & 0x10000) ? 30 : 29);
            }
            return 0;
        }

        // 获取某年闰几月
        function getLeapMonth(y) {
            return lunarData[y - 1900] & 0xf;
        }

        // 获取某年某月的天数
        function getMonthDays(y, m) {
            return ((lunarData[y - 1900] & (0x10000 >> m)) ? 30 : 29);
        }

        // 获取节气信息
        function getSolarTerm(y, n) {
            const offDate = new Date((31556925974.7 * (y - 1900) + solarTermInfo[n] * 60000) + Date.UTC(1900, 0, 6, 2, 5));
            return new Date(offDate.getUTCFullYear(), offDate.getUTCMonth(), offDate.getUTCDate());
        }

        // 获取六十甲子
        function getSexagenaryCycle(year, month, day, hour) {
            const baseYear = 1900; // 1900 年是庚子年
            const yearOffset = (year - baseYear) % 60;
            const yearGan = gan[yearOffset % 10];
            const yearZhi = zhi[yearOffset % 12];
            
            // 简化月份和日子的六十甲子计算
            const monthOffset = (year * 12 + month) % 60;
            const monthGan = gan[monthOffset % 10];
            const monthZhi = zhi[monthOffset % 12];
            
            const dayOffset = Math.floor((now - new Date(1900, 0, 1)) / 86400000) % 60;
            const dayGan = gan[dayOffset % 10];
            const dayZhi = zhi[dayOffset % 12];
            
            const hourIndex = Math.floor(hour / 2);
            const hourGan = gan[(dayOffset * 2 + hourIndex) % 10];
            const hourZhi = zhi[hourIndex % 12];
            
            return `${yearGan}${yearZhi}年-${monthGan}${monthZhi}月-${dayGan}${dayZhi}日-${hourGan}${hourZhi}时`;
        }

        // 获取节气信息
        function getSolarTermInfo() {
            const totalTerms = 24;
            const nowYear = now.getFullYear();
            let termIndex = 0;
            
            // 找到当前日期之后的第一个节气
            for (let i = 0; i < totalTerms; i++) {
                const termDate = getSolarTerm(nowYear, i);
                if (now < termDate) {
                    termIndex = i;
                    break;
                }
            }
            
            const lastTerm = solarTermNames[(termIndex - 1 + totalTerms) % totalTerms];
            const lastTermDate = getSolarTerm(nowYear, (termIndex - 1 + totalTerms) % totalTerms);
            const lastTermDays = Math.floor((now - lastTermDate) / 86400000);
            
            const nextTerm = solarTermNames[termIndex];
            const nextTermDate = getSolarTerm(nowYear, termIndex);
            const nextTermDays = Math.floor((nextTermDate - now) / 86400000);
            
            return `已过上一个节气:${lastTerm},${lastTermDays}天  距离下一个节气${nextTerm},还有${nextTermDays}天`;
        }

        // 格式化农历日期
        function formatLunarDay(day) {
            if (isNaN(day) || day < 1 || day > 30) {
                console.error('无效的农历日期:', day);
                return '初一';
            }
            if (day === 10) return '初十';
            if (day === 20) return '二十';
            if (day === 30) return '三十';
            return lunarDayNames[Math.floor(day / 10)] + dayNames[(day - 1) % 10];
        }

        // 生成结果
        const lunar = getLunarDate(now);
        const sexagenaryCycle = getSexagenaryCycle(year, month, day, hour);
        const solarTermInfoText = getSolarTermInfo();
        
        // 确保 lunar.day 是有效数字
        const lunarDayNumber = Number(lunar.day);
        if (isNaN(lunarDayNumber)) {
            console.error('农历日期不是有效数字:', lunar.day);
        }
        
        const result = `
            <div class="item"><strong>当前公历日期</strong>: ${year}年${month}月${day}日 ${hour}时${minute}分</div>
            <div class="item"><strong>当前农历日期</strong>: ${lunar.year}年${lunar.isLeap ? '闰' : ''}${lunarMonthNames[lunar.month - 1]}月${formatLunarDay(lunarDayNumber)}</div>
            <div class="item"><strong>六十甲子</strong>: ${sexagenaryCycle}</div>
            <div class="item"><strong>节气信息</strong>: ${solarTermInfoText}</div>
        `;

        // 检查是否是 curl 访问
        if (typeof navigator === 'undefined' || navigator.userAgent.includes('curl')) {
            console.log(result.replace(/<[^>]+>/g, ''));
        } else {
            document.getElementById('result').innerHTML = result;
        }
    </script>
</body>
</html>